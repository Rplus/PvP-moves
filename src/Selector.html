<script>
  import { dex, datalist, pokemon,  } from './stores.js';
  import { saveItem, getItem, toJSON, getDexFromUrl } from './u.js';

  let dexValue = $dex;
  let dexInput;
  let pmName = '';

  $: {
    if ($pokemon) {
      let target = $pokemon.find(pm => pm.dex === +dexValue);
      pmName = target && target.name || 'NG';
    }
  }

  window.addEventListener('popstate', (e) => {
    let dexOnUrl = getDexFromUrl();
    if ($dex !== dexOnUrl) {
      $dex = dexOnUrl;
    }
  });


  function updateDex(_dex) {
    $dex = _dex;
    history.pushState({}, _dex, `?dex=${_dex}`);
  }

  function onSubmit(e) {
    // validate
    if (!$pokemon.length) { return; }

    let _dexValue = +e.target.dex.value;
    let pm = $pokemon.find(pm => pm.dex === _dexValue);
    if (!pm) {
      console.error(`Wrong Dex: ${_dexValue}`);
      return;
    }
    console.info('submit', _dexValue, $dex);
    updateDex(_dexValue);
  }
</script>



<form class="selector L1-box df ai-b" on:submit|preventDefault={onSubmit}>
  <label class="mr-2" for="dex">Dex: #</label>
  <div class="input-wrapper mr-1">
    <input
      list="pm-names"
      class="pm-dex-selector mr-2"
      id="dex"
      name="dex"
      required
      pattern="\d+"
      title="Should be a Number."
      bind:value={dexValue}
      bind:this={dexInput}
    />
  </div>
  <button type="submit">ðŸ¤œ {pmName} ðŸ¤›</button>
  <datalist id="pm-names">
    {@html $datalist }
  </datalist>
</form>



<style>
.selector {
  max-width: 35rem;
  margin: 0 2.5vw;
  padding: 1rem 0 .5rem;
}
.input-wrapper {
  flex-grow: 1;
}
.pm-dex-selector {
  width: 100%;
}
.pm-dex-selector:invalid {
  box-shadow: inset 1px 1px 3px #900;
}
</style>
