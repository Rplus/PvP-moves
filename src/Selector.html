<script>
  import { dex, formId, datalist, pokemon } from './stores.js';
  import { saveItem, getItem, toJSON, getDexFromUrl } from './u.js';

  let dexValue = $dex;
  let dexInput;
  let pmName = '';

  $: {
    let target = $pokemon.length && $pokemon.find(pm => pm.uid === dexValue);
    pmName = target ? target.name : 'NG';
  }


  function onSubmit(e) {
    // validate
    if (!$pokemon.length) { return; }

    let _inputValue = e.target.dex.value;
    let pm = $pokemon.find(pm => pm.uid === _inputValue);
    if (!pm) {
      console.error(`Wrong Dex: ${_inputValue}`);
      return;
    }
    console.info('submit', _inputValue, $dex);
    $dex = _inputValue;
  }
</script>



<form class="selector card L1-box df ai-b whs-nw" on:submit|preventDefault={onSubmit}>
  <label class="mr-2" for="dex">Dex: #</label>
  <div class="input-wrapper mr-1">
    <input
      list="pm-names"
      class="pm-dex-selector mr-2"
      id="dex"
      name="dex"
      required
      pattern="\d+(_\D+)?"
      title="GG"
      bind:value={dexValue}
      bind:this={dexInput}
    />
  </div>
  <button type="submit">ðŸ¤œ {pmName} ðŸ¤›</button>
  <datalist id="pm-names">
    {@html $datalist }
  </datalist>
</form>



<style>
.selector {
  position: sticky;
  top: 0;
  z-index: 1;
  padding-top: .5rem;
}
.input-wrapper {
  flex-grow: 1;
}
.pm-dex-selector {
  width: 100%;
}
.pm-dex-selector:invalid {
  box-shadow: inset 1px 1px 3px #900;
}
button {
}
</style>
